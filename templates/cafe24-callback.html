<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Cafe24 Callback</title>
</head>
<body>
    <h1>카페24 연동 처리 중...</h1>
    <p>잠시만 기다려 주세요.</p>

    <script>
        async function handleCafe24Callback() {
            console.log("카페24 콜백 페이지 로드됨.");
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            const state = urlParams.get('state'); 

            if (code) {
                console.log("인증 코드(Code) 획득:", code);
                const backendBaseUrl = "http://localhost:8080"; // <<<--- 중요: 백엔드 URL 설정
                try {
                    const response = await fetch(`${backendBaseUrl}/api/v1/oauth/cafe24/callback?code=${code}`, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                    });

                    if (!response.ok) {
                        const errorDetails = await response.text();
                        throw new Error(`백엔드 API 호출 실패: ${response.status} ${response.statusText} - ${errorDetails}`);
                    }
                    console.log("인증 코드를 백엔드로 성공적으로 전달했습니다.");
                    alert("카페24 연동이 성공적으로 완료되었습니다.");
                    window.location.href = "/"; // Redirect to home or a success page
                } catch (error) {
                    console.error("인증 코드를 백엔드로 전달 중 에러 발생:", error);
                    alert("카페24 연동 처리 중 오류가 발생했습니다: " + error.message);
                    window.location.href = "/"; // Redirect to home or an error page
                }
            } else {
                console.error("URL에서 인증 코드를 찾을 수 없습니다.");
                alert("카페24 연동에 실패했습니다. 인증 코드를 받지 못했습니다.");
                window.location.href = "/"; // Redirect to home or an error page
            }
        }

        // 페이지 로드 시 콜백 핸들러 자동 실행 (cafe24-callback 페이지에서)
        document.addEventListener('DOMContentLoaded', handleCafe24Callback);
    </script>
</body>
</html>
