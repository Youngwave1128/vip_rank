<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Cafe24 Callback</title>
</head>
<body>
    <h1>카페24 연동 처리 중...</h1>
    <p>잠시만 기다려 주세요.</p>

    <script>
        async function handleCafe24OAuthCallback() {
            console.log("카페24 콜백 페이지 로드됨.");
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            const state = urlParams.get('state');
            if (code) {
                console.log("인증 코드(Code) 획득:", code);
                const backendBaseUrl = "http://localhost:8080"; // <<<--- 중요: 백엔드 URL 설정 (로컬 테스트 시)
                // **수정된 부분**: fetch 요청 대신 브라우저를 백엔드 콜백 URL로 직접 리다이렉션
                // 이렇게 하면 백엔드의 RedirectView가 브라우저에 의해 올바르게 처리됩니다.
                window.location.href = `${backendBaseUrl}/api/v1/oauth/cafe24/callback?code=${code}`;
                // 이 아래의 console.log나 alert 등은 백엔드의 리다이렉션이 발생하면 실행되지 않을 수 있습니다.
                console.log("인증 코드를 백엔드로 전달했습니다. 백엔드의 리다이렉션을 기다립니다.");
            } else {
                console.error("URL에서 인증 코드를 찾을 수 없습니다.");
                alert("카페24 연동에 실패했습니다. 인증 코드를 받지 못했습니다.");
                window.location.href = "/"; // 인증 코드가 없을 경우 홈으로 리다이렉션
            }
        }
        document.addEventListener('DOMContentLoaded', handleCafe24OAuthCallback);
    </script>
</body>
</html>
